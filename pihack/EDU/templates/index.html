{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Study Plan</title>
  <link href="{% static 'styles.css' %}" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Create Your Study Plan</h1>
    <form id="study-plan-form" class="form-layout">
      <div class="form-group">
        <label for="study-type">Study Type:</label>
        <select id="study-type" required>
          <option value="weekdays">Weekdays</option>
          <option value="weekends">Weekends</option>
        </select>
      </div>

      <div class="form-group">
        <label for="hours-per-day">Hours Per Day:</label>
        <input type="number" id="hours-per-day" min="1" required>
      </div>

      <div class="form-group">
        <label for="start-time">Start Time:</label>
        <input type="time" id="start-time" required>
      </div>

      <div class="form-group">
        <label for="number-of-subjects">Number of Subjects:</label>
        <input type="number" id="number-of-subjects" min="1" required>
      </div>

      <div id="subjects-container"></div>

      <button type="submit" class="btn">Create Study Plan</button><br>
    </form>
    <div class="centered-content">
    <a href="draft_plan.html" class="btn">Go to Draft Plan</a>
    </div>
  </div>

  <script>
    const form = document.getElementById('study-plan-form');
    const subjectsContainer = document.getElementById('subjects-container');
    const numberOfSubjectsInput = document.getElementById('number-of-subjects');

    // Dynamically create subject fields
    numberOfSubjectsInput.addEventListener('input', () => {
      const count = parseInt(numberOfSubjectsInput.value) || 0;
      subjectsContainer.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        subjectsContainer.innerHTML += `
          <div class="subject-group">
            <div class="form-group">
              <label for="subject-name-${i}">Subject ${i} Name:</label>
              <input type="text" id="subject-name-${i}" required>
            </div>
            
            <div class="form-group">
              <label for="subject-resource-${i}">Resource (Link):</label>
              <input type="url" id="subject-resource-${i}" required>
            </div>
            
            <div class="form-group">
              <label for="subject-priority-${i}">Priority:</label>
              <input type="number" id="subject-priority-${i}" min="1" required>
            </div>
          </div>
        `;
      }
    });

    // Handle form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const studyPlan = {
        studyType: document.getElementById('study-type').value,
        hoursPerDay: parseInt(document.getElementById('hours-per-day').value),
        startTime: document.getElementById('start-time').value,
        subjects: [],
      };

      const count = parseInt(numberOfSubjectsInput.value) || 0;
      for (let i = 1; i <= count; i++) {
        const name = document.getElementById(`subject-name-${i}`).value;
        const resource = document.getElementById(`subject-resource-${i}`).value;
        const priority = parseInt(document.getElementById(`subject-priority-${i}`).value);

        studyPlan.subjects.push({ name, resource, priority });
      }

      // Save study plan to localStorage
      localStorage.setItem('studyPlan', JSON.stringify(studyPlan));
      alert('Study Plan created successfully!');

      // Redirect to draft plan page
      window.location.href = 'draft_plan.html';
    });
  </script>
</body>
</html>